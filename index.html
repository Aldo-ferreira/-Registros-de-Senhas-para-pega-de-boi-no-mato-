<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <!-- ... (mantenha todo o head igual) ... -->
</head>
<body>
    <!-- ... (mantenha todo o body igual até o script) ... -->

    <script>
        const firebaseConfig = {
            apiKey: "SUA_API_KEY",
            databaseURL: "SUA_DATABASE_URL",
            projectId: "SEU_PROJECT_ID",
            appId: "SEU_APP_ID"
        };

        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();

        let maxNumeros = 200;
        let numeros = {};
        let backupNumeros = {};

        // CORREÇÃO PRINCIPAL: Nova estrutura de dados
        function carregarDados() {
            database.ref('numeros').on('value', snapshot => {
                const data = snapshot.val() || {};
                numeros = {...data};
                preencherNumerosFaltantes();
                atualizarTabela();
            });
        }

        function preencherNumerosFaltantes() {
            for(let i = 1; i <= maxNumeros; i++) {
                if(!numeros[i]) {
                    numeros[i] = {
                        numero: i,
                        nome: '',
                        pago: false
                    };
                }
            }
        }

        function atualizarTabela() {
            const tbody = document.getElementById('tabela');
            tbody.innerHTML = '';
            
            for(let i = 1; i <= maxNumeros; i++) {
                const item = numeros[i];
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td>${item.numero}</td>
                    <td>${item.nome || 'Disponível'}</td>
                    <td>${item.pago ? 'Pago' : item.nome ? 'Pendente' : 'Disponível'}</td>
                    <td>
                        ${item.nome ? `
                            <button class="pago-btn" onclick="marcarPago(${item.numero})">
                                ${item.pago ? 'Cancelar' : 'Pago'}
                            </button>
                            <button class="editar-btn" onclick="editar(${item.numero})">Editar</button>
                            <button class="disponibilizar-btn" onclick="disponibilizar(${item.numero})">Liberar</button>
                        ` : ''}
                    </td>
                `;
                tbody.appendChild(tr);
            }
        }

        // FUNÇÕES ATUALIZADAS PARA NOVA ESTRUTURA
        function registrar() {
            const numero = parseInt(document.getElementById('numero').value);
            const nome = document.getElementById('nome').value.trim();

            if (!numero || numero < 1 || numero > maxNumeros) {
                alert(`Número inválido! (1-${maxNumeros})`);
                return;
            }

            if (numeros[numero].nome) {
                alert('Número já registrado!');
                return;
            }

            numeros[numero] = {
                numero: numero,
                nome: nome,
                pago: false
            };
            
            database.ref('numeros').set(numeros);
            document.getElementById('numero').value = '';
            document.getElementById('nome').value = '';
        }

        function marcarPago(numero) {
            numeros[numero].pago = !numeros[numero].pago;
            database.ref('numeros').set(numeros);
        }

        // ... (atualize as demais funções seguindo o mesmo padrão) ...

        // INICIALIZAÇÃO GARANTIDA
        window.addEventListener('load', () => {
            carregarDados();
            setInterval(() => database.ref('numeros').set(numeros), 5000); // Força sincronização
        });
    </script>
</body>
</html>
