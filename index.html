<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="description" content="Sistema de escolha de n√∫meros para Pega de Boi">
    <meta name="theme-color" content="#4CAF50">
    <title>Escolha de N√∫meros - Pega de Boi</title>
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-database-compat.js"></script>
    
    <style>
        * {
            box-sizing: border-box;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }
        
        body { 
            font-family: Arial, Helvetica, sans-serif;
            margin: 0 auto;
            padding: 20px;
            max-width: 1200px;
            background-color: #f5f5f5;
        }
        
        h1 { 
            font-size: 1.8em;
            text-align: center;
        }
        
        h2 {
            font-size: 1.5em;
            margin-top: 20px;
        }
        
        h3 {
            font-size: 1.2em;
            text-align: center;
        }

        .form-group {
            margin: 10px 0;
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            align-items: center;
        }

        table { 
            width: 100%; 
            border-collapse: collapse; 
            margin-top: 20px;
            font-size: 0.9em;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            background: white;
            border-radius: 4px;
            overflow: hidden;
        }
        
        th, td { 
            border: 1px solid #ddd; 
            padding: 8px; 
            text-align: center; 
        }
        
        th { 
            background-color: #f4f4f4; 
        }
        
        input { 
            padding: 8px; 
            margin: 5px 0; 
            border: 1px solid #ddd; 
            border-radius: 4px;
            flex: 1;
            min-width: 120px;
        }
        
        button { 
            padding: 8px 15px; 
            margin: 5px 2px; 
            cursor: pointer; 
            border: none; 
            border-radius: 4px; 
            font-weight: bold; 
            transition: all 0.3s ease;
            white-space: nowrap;
        }
        
        button:hover { 
            opacity: 0.9; 
        }
        
        .pago { 
            color: #4CAF50; 
            font-weight: bold; 
        }
        
        #listaWhatsApp { 
            width: 100%; 
            margin-top: 10px; 
            padding: 10px; 
            border: 1px solid #ddd; 
            border-radius: 4px; 
            height: 200px;
        }

        #filtroStatus {
            padding: 8px;
            margin: 5px;
            border: 1px solid #ddd;
            border-radius: 4px;
            background-color: #673ab7;
            color: white;
            cursor: pointer;
            font-weight: bold;
            min-width: 120px;
        }

        #filtroStatus option {
            background-color: white;
            color: black;
            padding: 8px;
        }

        /* Cores dos bot√µes */
        button[onclick="registrar()"] { background-color: #4CAF50; color: white; }
        button[onclick="atualizarQuantidadeSenhas()"] { background-color: #ff9800; color: white; }
        button[onclick="gerarLista()"] { background-color: #9c27b0; color: white; }
        button[onclick="limparLista()"] { background-color: #f44336; color: white; }
        button[onclick^="marcarPago"] { background-color: #4CAF50; color: white; padding: 5px 10px; font-size: 0.9em; }
        button[onclick^="editar"] { background-color: #2196F3; color: white; padding: 5px 10px; font-size: 0.9em; }
        button[onclick^="disponibilizar"] { background-color: #ff9800; color: white; padding: 5px 10px; font-size: 0.9em; }

        @media screen and (max-width: 768px) {
            body { margin: 10px; padding: 10px; }
            .form-group { flex-direction: column; align-items: stretch; }
            input, button, #filtroStatus { width: 100%; margin: 5px 0; }
            table { font-size: 0.8em; }
            td button { margin: 2px; padding: 5px; font-size: 0.8em; width: auto; }
        }

        @supports (-webkit-appearance: none) or (-moz-appearance: none) {
            select {
                -webkit-appearance: none;
                -moz-appearance: none;
                background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='white'%3e%3cpath d='M7 10l5 5 5-5z'/%3e%3c/svg%3e");
                background-repeat: no-repeat;
                background-position: right 8px center;
                padding-right: 30px;
            }
        }
    </style>
</head>
<body>
    <h1>Escolha de N√∫meros - Pega de Boi</h1>
    <h3>Cada n√∫mero vale por um boi. Escolha seu n√∫mero e registre seu nome!</h3>

    <div class="form-group">
        <label for="numero">N√∫mero:</label>
        <input type="number" id="numero" placeholder="Digite o n√∫mero">
        <label for="nome">Seu Nome:</label>
        <input type="text" id="nome" placeholder="Digite seu nome">
        <button onclick="registrar()">Registrar</button>
    </div>

    <h2>Editar Quantidade de Senhas</h2>
    <div class="form-group">
        <label for="quantidadeSenhas">Nova quantidade (entre 1 e 1000):</label>
        <input type="number" id="quantidadeSenhas" min="1" max="1000" placeholder="Ex: 200">
        <button onclick="atualizarQuantidadeSenhas()">Atualizar Quantidade de Senhas</button>
    </div>

    <h2>Lista de N√∫meros Escolhidos</h2>
    <div class="form-group">
        <input type="text" id="buscarNome" placeholder="Buscar por nome..." oninput="filtrarTabela()">
        <input type="number" id="buscarNumero" placeholder="Buscar por n√∫mero..." oninput="filtrarTabela()">
        <select id="filtroStatus" onchange="filtrarTabela()">
            <option value="todos">Todos os Status</option>
            <option value="disponivel">Dispon√≠veis</option>
            <option value="pendente">Pendentes</option>
            <option value="pago">Pagos</option>
        </select>
    </div>
    <table>
        <thead>
            <tr>
                <th>N√∫mero</th>
                <th>Nome</th>
                <th>Status</th>
                <th>A√ß√µes</th>
            </tr>
        </thead>
        <tbody id="tabela"></tbody>
    </table>

    <button onclick="gerarLista()">Gerar Lista para WhatsApp</button>
    <textarea id="listaWhatsApp" placeholder="Lista gerada aparecer√° aqui..." readonly></textarea>
    <button onclick="limparLista()">Limpar Lista</button>

    <script>
        // Configura√ß√£o do Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyBQpSLAAcLAGcv25sjFmHAQ30qysN2jv2U",
            authDomain: "pega-de-boi-b179c.firebaseapp.com",
            projectId: "pega-de-boi-b179c",
            storageBucket: "pega-de-boi-b179c.firebasestorage.app",
            messagingSenderId: "915850531026",
            appId: "1:915850531026:web:7f0491acb09ca8441c1d0b",
            databaseURL: "https://pega-de-boi-b179c-default-rtdb.firebaseio.com"
        };

        // Inicializar Firebase
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();
        const numerosRef = database.ref('numeros');
        
        let numeros = [];

        // Carregar dados iniciais
        numerosRef.once('value').then((snapshot) => {
            if (snapshot.exists()) {
                numeros = snapshot.val();
            } else {
                // Se n√£o existir dados, criar lista inicial com 50 n√∫meros
                numeros = Array.from({ length: 50 }, (_, i) => ({ 
                    numero: i + 1, 
                    nome: '', 
                    pago: false 
                }));
                salvarDados();
            }
            atualizarTabela();
        }).catch(error => {
            console.error("Erro ao carregar dados:", error);
            alert("Erro ao carregar dados. Por favor, recarregue a p√°gina.");
        });

        // Ouvir mudan√ßas em tempo real
        numerosRef.on('value', (snapshot) => {
            if (snapshot.exists()) {
                numeros = snapshot.val();
                filtrarTabela(); // Atualiza a interface quando houver mudan√ßas
            }
        });

        function salvarDados() {
            try {
                numerosRef.set(numeros);
            } catch (erro) {
                alert('Erro ao salvar os dados. Por favor, tente novamente.');
                console.error('Erro ao salvar:', erro);
            }
        }

        function atualizarTabela() {
            filtrarTabela();
            salvarDados();
        }

        function registrar() {
            const numero = parseInt(document.getElementById('numero').value);
            const nome = document.getElementById('nome').value.trim();

            if (!numero || numero < 1 || numero > numeros.length) {
                alert(`Escolha um n√∫mero v√°lido entre 1 e ${numeros.length}.`);
                return;
            }
            if (!nome) {
                alert('Por favor, insira seu nome.');
                return;
            }

            const index = numeros.findIndex(item => item.numero === numero);
            if (numeros[index].nome) {
                alert('Esse n√∫mero j√° foi escolhido. Por favor, escolha outro.');
                return;
            }

            numeros[index].nome = nome;
            atualizarTabela();
            document.getElementById('numero').value = '';
            document.getElementById('nome').value = '';
        }

        function marcarPago(numero) {
            const index = numeros.findIndex(item => item.numero === numero);
            if (index >= 0) {
                numeros[index].pago = !numeros[index].pago;
                atualizarTabela();
            }
        }

        function editar(numero) {
            const index = numeros.findIndex(item => item.numero === numero);
            if (index >= 0) {
                const novoNome = prompt('Digite o novo nome:', numeros[index].nome);
                if (novoNome !== null) {
                    numeros[index].nome = novoNome.trim();
                    atualizarTabela();
                }
            }
        }

        function disponibilizar(numero) {
            const index = numeros.findIndex(item => item.numero === numero);
            if (index >= 0) {
                numeros[index].nome = '';
                numeros[index].pago = false;
                atualizarTabela();
            }
        }

        function gerarLista() {
            const lista = [
                "üé´ Lista de N√∫meros - Pega de Boi üêÇ",
                "N√∫mero | Nome | Status",
                ...numeros.map(item => {
                    let status = '';
                    if (item.nome) {
                        status = item.pago ? '‚úÖ' : '‚åõ';
                    } else {
                        status = 'Dispon√≠vel';
                    }
                    return `${item.numero} | ${item.nome || 'Dispon√≠vel'} ${status}`
                })
            ];
            const textoLista = lista.join('\n');
            document.getElementById('listaWhatsApp').value = textoLista;
        }

        function limparLista() {
            numeros = [];
            atualizarTabela();
            document.getElementById('listaWhatsApp').value = '';
        }

        function atualizarQuantidadeSenhas() {
            const novaQuantidade = parseInt(document.getElementById('quantidadeSenhas').value);
            
            if (!novaQuantidade || novaQuantidade < 1 || novaQuantidade > 1000) {
                alert('Por favor, insira uma quantidade v√°lida entre 1 e 1000.');
                return;
            }

            // Criar nova lista com a quantidade desejada
            const novaLista = Array.from({ length: novaQuantidade }, (_, i) => ({
                numero: i + 1,
                nome: '',
                pago: false
            }));

            // Atualizar a lista no Firebase
            numerosRef.set(novaLista)
                .then(() => {
                    numeros = novaLista;
                    atualizarTabela();
                    alert(`Lista atualizada com ${novaQuantidade} senhas.`);
                    document.getElementById('quantidadeSenhas').value = '';
                })
                .catch(error => {
                    console.error("Erro ao atualizar quantidade:", error);
                    alert("Erro ao atualizar quantidade. Por favor, tente novamente.");
                });
        }

        function filtrarTabela() {
            const buscarNome = document.getElementById('buscarNome').value.toLowerCase();
            const buscarNumero = document.getElementById('buscarNumero').value;
            const filtroStatus = document.getElementById('filtroStatus').value;

            let tabela = document.getElementById('tabela');
            tabela.innerHTML = '';

            let dadosFiltrados = numeros;

            if (filtroStatus !== 'todos') {
                dadosFiltrados = dadosFiltrados.filter(item => item.pago === (filtroStatus === 'pago'));
            }

            if (buscarNome || buscarNumero) {
                dadosFiltrados = dadosFiltrados.filter(item => {
                    const matchNome = item.nome && item.nome.toLowerCase().includes(buscarNome);
                    const matchNumero = item.numero.toString().includes(buscarNumero);
                    return matchNome || matchNumero;
                });
            }

            dadosFiltrados.forEach(item => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${item.numero}</td>
                    <td>${item.nome || 'Dispon√≠vel'}</td>
                    <td>${item.pago ? 'Pago' : 'Pendente'}</td>
                    <td>
                        <button onclick="marcarPago(${item.numero})">${item.pago ? 'Marcar como pendente' : 'Marcar como pago'}</button>
                        <button onclick="editar(${item.numero})">Editar</button>
                        <button onclick="disponibilizar(${item.numero})">Disponibilizar</button>
                    </td>
                `;
                tabela.appendChild(row);
            });
        }
    </script>
</body>
</html>
