<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema Pega de Boi - Online</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Roboto&display=swap">
    <style>
        /* (estilos completos do CSS foram mantidos como no original) */
    </style>
</head>
<body>
    <div id="statusOnline"></div>
    <div id="mainArea">
        <h1>Sistema Pega de Boi - Online</h1>
        <h3>Escolha seu número e registre seu nome!</h3>

        <div class="btn-container">
            <button class="disponibilizar-todo-btn" onclick="disponibilizarTodos()">Disponibilizar Todos</button>
            <button class="reverter-btn" onclick="reverterDisponibilizacao()">Reverter Disponibilização</button>
        </div>

        <div class="form-group">
            <label for="quantidade">Quantidade de Números:</label>
            <input type="number" id="quantidade" min="1" max="500" value="200" onchange="atualizarQuantidade()">
        </div>

        <div class="form-group">
            <label for="numero">Número (1 a <span id="maxNumero">200</span>):</label>
            <input type="number" id="numero" min="1" placeholder="Digite o número">
            <label for="nome">Nome:</label>
            <input type="text" id="nome" placeholder="Digite o nome">
            <button class="registrar-btn" onclick="registrar()">Registrar</button>
        </div>

        <div class="form-group">
            <h2>Verificar Disponibilidade</h2>
            <input type="number" id="verificarNumero" min="1" placeholder="Digite o número">
            <button class="gerar-btn" onclick="verificarDisponibilidade()">Verificar</button>
            <p id="statusNumero"></p>
        </div>

        <div class="table-container">
            <h2>Lista de Números Escolhidos</h2>
            <table>
                <thead>
                    <tr>
                        <th>Número</th>
                        <th>Nome</th>
                        <th>Status</th>
                        <th>Ações</th>
                    </tr>
                </thead>
                <tbody id="tabela"></tbody>
            </table>
        </div>

        <div class="form-group">
            <button class="gerar-btn" onclick="gerarLista()">Gerar Lista para WhatsApp</button>
            <textarea id="listaWhatsApp" rows="10" placeholder="Lista gerada aparecerá aqui..." readonly></textarea>
        </div>
    </div>

    <script>
        const firebaseConfig = {
            apiKey: "SUA-API-KEY",
            authDomain: "seu-projeto.firebaseapp.com",
            databaseURL: "https://seu-projeto.firebaseio.com",
            projectId: "seu-projeto",
            storageBucket: "seu-projeto.appspot.com",
            messagingSenderId: "seu-messaging-id",
            appId: "seu-app-id"
        };

        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        let quantidade = 200;
        function atualizarQuantidade() {
            quantidade = parseInt(document.getElementById("quantidade").value);
            document.getElementById("maxNumero").textContent = quantidade;
            carregarDados();
        }

        function registrar() {
            const numero = document.getElementById("numero").value;
            const nome = document.getElementById("nome").value;
            if (!numero || !nome) return alert("Preencha todos os campos.");
            db.ref("numeros/" + numero).set({ nome, status: "ocupado" });
        }

        function verificarDisponibilidade() {
            const numero = document.getElementById("verificarNumero").value;
            db.ref("numeros/" + numero).once("value").then(snapshot => {
                const dados = snapshot.val();
                if (dados) {
                    document.getElementById("statusNumero").textContent = `Número ocupado por ${dados.nome}`;
                } else {
                    document.getElementById("statusNumero").textContent = "Número disponível";
                }
            });
        }

        function gerarLista() {
            db.ref("numeros").once("value").then(snapshot => {
                const dados = snapshot.val();
                let lista = "";
                for (let i = 1; i <= quantidade; i++) {
                    if (dados && dados[i]) {
                        lista += `${i} - ${dados[i].nome}\n`;
                    }
                }
                document.getElementById("listaWhatsApp").value = lista;
            });
        }

        function carregarDados() {
            db.ref("numeros").on("value", snapshot => {
                const dados = snapshot.val();
                const tabela = document.getElementById("tabela");
                tabela.innerHTML = "";
                for (let i = 1; i <= quantidade; i++) {
                    const info = dados && dados[i] ? dados[i] : {};
                    const nome = info.nome || "-";
                    const status = info.status === "ocupado" ? "Ocupado" : "Disponível";
                    tabela.innerHTML += `
                        <tr>
                            <td>${i}</td>
                            <td>${nome}</td>
                            <td>${status}</td>
                            <td>
                                <button class="pago-btn" onclick="marcarComoPago(${i})">Pago</button>
                                <button class="editar-btn" onclick="editar(${i})">Editar</button>
                                <button class="disponibilizar-btn" onclick="disponibilizar(${i})">Liberar</button>
                            </td>
                        </tr>`;
                }
            });
        }

        function marcarComoPago(numero) {
            db.ref("numeros/" + numero + "/status").set("pago");
        }

        function editar(numero) {
            const novoNome = prompt("Digite o novo nome:");
            if (novoNome) db.ref("numeros/" + numero + "/nome").set(novoNome);
        }

        function disponibilizar(numero) {
            db.ref("numeros/" + numero).remove();
        }

        function disponibilizarTodos() {
            for (let i = 1; i <= quantidade; i++) {
                db.ref("numeros/" + i).remove();
            }
        }

        function reverterDisponibilizacao() {
            for (let i = 1; i <= quantidade; i++) {
                db.ref("numeros/" + i).once("value").then(snapshot => {
                    if (!snapshot.exists()) {
                        db.ref("numeros/" + i).set({ nome: "-", status: "disponivel" });
                    }
                });
            }
        }

        function verificarOnline() {
            db.ref(".info/connected").on("value", snap => {
                const el = document.getElementById("statusOnline");
                if (snap.val() === true) {
                    el.textContent = "Online";
                    el.className = "online";
                } else {
                    el.textContent = "Offline";
                    el.className = "offline";
                }
            });
        }

        atualizarQuantidade();
        verificarOnline();
    </script>
</body>
</html>
