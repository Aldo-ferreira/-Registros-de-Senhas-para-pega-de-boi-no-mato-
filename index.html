<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="description" content="Sistema de escolha de números para Pega de Boi">
    <meta name="theme-color" content="#4CAF50">
    <title>Escolha de Números - Pega de Boi</title>
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-database-compat.js"></script>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Font Awesome para ícones -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        * {
            box-sizing: border-box;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }
        
        body { 
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0 auto;
            padding: 20px;
            max-width: 1200px;
            background-color: #f8fafc;
        }
        
        h1 { 
            font-size: 2em;
            text-align: center;
            color: #1e293b;
            margin-bottom: 0.5rem;
        }
        
        h2 {
            font-size: 1.5em;
            margin-top: 20px;
            color: #334155;
        }
        
        h3 {
            font-size: 1.2em;
            text-align: center;
            color: #475569;
            margin-bottom: 1.5rem;
        }

        .form-group {
            margin: 10px 0;
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            align-items: center;
        }

        table { 
            width: 100%; 
            border-collapse: collapse; 
            margin-top: 20px;
            font-size: 0.9em;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            background: white;
            border-radius: 8px;
            overflow: hidden;
        }
        
        th, td { 
            border: 1px solid #e2e8f0; 
            padding: 12px; 
            text-align: center; 
        }
        
        th { 
            background-color: #f1f5f9; 
            font-weight: 600;
            color: #334155;
        }
        
        input { 
            padding: 10px; 
            margin: 5px 0; 
            border: 1px solid #cbd5e1; 
            border-radius: 6px;
            flex: 1;
            min-width: 120px;
            transition: border-color 0.3s;
        }
        
        input:focus {
            outline: none;
            border-color: #4f46e5;
            box-shadow: 0 0 0 2px rgba(79, 70, 229, 0.2);
        }
        
        button { 
            padding: 10px 16px; 
            margin: 5px 2px; 
            cursor: pointer; 
            border: none; 
            border-radius: 6px; 
            font-weight: 600; 
            transition: all 0.3s ease;
            white-space: nowrap;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        
        button:hover { 
            transform: translateY(-1px); 
        }
        
        .pago { 
            color: #10b981; 
            font-weight: bold; 
        }
        
        #listaWhatsApp { 
            width: 100%; 
            margin-top: 10px; 
            padding: 12px; 
            border: 1px solid #e2e8f0; 
            border-radius: 8px; 
            height: 200px;
            font-family: monospace;
            resize: vertical;
            transition: border-color 0.3s;
        }

        #listaWhatsApp:focus {
            outline: none;
            border-color: #4f46e5;
            box-shadow: 0 0 0 2px rgba(79, 70, 229, 0.2);
        }

        #filtroStatus {
            padding: 10px;
            margin: 5px;
            border: 1px solid #cbd5e1;
            border-radius: 6px;
            background-color: #4f46e5;
            color: white;
            cursor: pointer;
            font-weight: 600;
            min-width: 120px;
            transition: all 0.3s;
        }

        #filtroStatus:hover {
            background-color: #4338ca;
        }

        #filtroStatus option {
            background-color: white;
            color: #1e293b;
            padding: 8px;
        }

        /* Button colors */
        button[onclick="registrar()"] { background-color: #10b981; color: white; }
        button[onclick="atualizarQuantidadeSenhas()"] { background-color: #f59e0b; color: white; }
        button[onclick="gerarLista()"] { background-color: #8b5cf6; color: white; }
        button[onclick="copiarLista()"] { background-color: #3b82f6; color: white; }
        button[onclick="limparLista()"] { background-color: #ef4444; color: white; }
        button[onclick^="marcarPago"] { background-color: #10b981; color: white; padding: 8px 12px; font-size: 0.9em; }
        button[onclick^="editar"] { background-color: #3b82f6; color: white; padding: 8px 12px; font-size: 0.9em; }
        button[onclick^="disponibilizar"] { background-color: #f59e0b; color: white; padding: 8px 12px; font-size: 0.9em; }

        .action-buttons {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
            justify-content: center;
        }

        .toast {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background-color: #10b981;
            color: white;
            padding: 12px 24px;
            border-radius: 8px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            display: flex;
            align-items: center;
            gap: 12px;
            opacity: 0;
            transition: opacity 0.3s;
            z-index: 1000;
        }

        .toast.show {
            opacity: 1;
        }

        @media screen and (max-width: 768px) {
            body { margin: 10px; padding: 10px; }
            .form-group { flex-direction: column; align-items: stretch; }
            input, button, #filtroStatus { width: 100%; margin: 5px 0; }
            table { font-size: 0.8em; }
            .action-buttons { flex-direction: column; gap: 6px; }
            td button { margin: 2px; padding: 6px; font-size: 0.8em; width: auto; }
        }

        @supports (-webkit-appearance: none) or (-moz-appearance: none) {
            select {
                -webkit-appearance: none;
                -moz-appearance: none;
                appearance: none;
                background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='white'%3e%3cpath d='M7 10l5 5 5-5z'/%3e%3c/svg%3e");
                background-repeat: no-repeat;
                background-position: right 12px center;
                padding-right: 36px;
            }
        }
    </style>
</head>
<body class="bg-gray-50">
    <div class="max-w-4xl mx-auto">
        <header class="mb-8 text-center">
            <h1 class="text-3xl font-bold text-gray-800">Sistema de Senhas - Vaquejadas e Pega de Boi no Mato</h1>
            <h3 class="text-lg text-gray-600">Cada número vale por um boi. Escolha seu número e registre o nome!</h3>
        </header>

        <div class="bg-white p-6 rounded-lg shadow-md mb-6">
            <div class="form-group">
                <label for="numero" class="text-gray-700 font-medium">Número:</label>
                <input type="number" id="numero" placeholder="Digite o número" class="border-gray-300 focus:border-indigo-500">
                <label for="nome" class="text-gray-700 font-medium">Seu Nome:</label>
                <input type="text" id="nome" placeholder="Digite seu nome" class="border-gray-300 focus:border-indigo-500">
                <button onclick="registrar()">
                    <i class="fas fa-check-circle"></i> Registrar
                </button>
            </div>
        </div>

        <div class="bg-white p-6 rounded-lg shadow-md mb-6">
            <h2 class="text-xl font-semibold text-gray-800 mb-4">Editar Quantidade de Senhas</h2>
            <div class="form-group">
                <label for="quantidadeSenhas" class="text-gray-700 font-medium">Nova quantidade (entre 1 e 1000):</label>
                <input type="number" id="quantidadeSenhas" min="1" max="1000" placeholder="Ex: 200" class="border-gray-300 focus:border-indigo-500">
                <button onclick="atualizarQuantidadeSenhas()">
                    <i class="fas fa-sync-alt"></i> Atualizar Quantidade
                </button>
            </div>
        </div>

        <div class="bg-white p-6 rounded-lg shadow-md mb-6">
            <h2 class="text-xl font-semibold text-gray-800 mb-4">Lista de Números Escolhidos</h2>
            <div class="form-group">
                <input type="text" id="buscarNome" placeholder="Buscar por nome..." oninput="filtrarTabela()" class="border-gray-300 focus:border-indigo-500">
                <input type="number" id="buscarNumero" placeholder="Buscar por número..." oninput="filtrarTabela()" class="border-gray-300 focus:border-indigo-500">
                <select id="filtroStatus" onchange="filtrarTabela()">
                    <option value="todos">Todos os Status</option>
                    <option value="disponivel">Disponíveis</option>
                    <option value="pendente">Pendentes</option>
                    <option value="pago">Pagos</option>
                </select>
            </div>
            <div class="overflow-x-auto">
                <table>
                    <thead>
                        <tr>
                            <th>Número</th>
                            <th>Nome</th>
                            <th>Status</th>
                            <th>Ações</th>
                        </tr>
                    </thead>
                    <tbody id="tabela"></tbody>
                </table>
            </div>
        </div>

        <div class="bg-white p-6 rounded-lg shadow-md">
            <h2 class="text-xl font-semibold text-gray-800 mb-4">Lista para WhatsApp</h2>
            <div class="flex flex-wrap gap-3 mb-4">
                <button onclick="gerarLista()" class="hover:bg-purple-700">
                    <i class="fas fa-list"></i> Gerar Lista
                </button>
                <button onclick="copiarLista()" class="hover:bg-blue-700" id="copyButton">
                    <i class="far fa-copy"></i> Copiar Lista
                </button>
                <button onclick="limparLista()" class="hover:bg-red-700">
                    <i class="fas fa-trash-alt"></i> Limpar Lista
                </button>
            </div>
            <textarea id="listaWhatsApp" placeholder="Lista gerada aparecerá aqui..." readonly></textarea>
        </div>
    </div>

    <div id="toast" class="toast">
        <i class="fas fa-check-circle"></i>
        <span>Lista copiada para a área de transferência!</span>
    </div>

    <script>
        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyBQpSLAAcLAGcv25sjFmHAQ30qysN2jv2U",
            authDomain: "pega-de-boi-b179c.firebaseapp.com",
            projectId: "pega-de-boi-b179c",
            storageBucket: "pega-de-boi-b179c.firebasestorage.app",
            messagingSenderId: "915850531026",
            appId: "1:915850531026:web:7f0491acb09ca8441c1d0b",
            databaseURL: "https://pega-de-boi-b179c-default-rtdb.firebaseio.com"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();
        const numerosRef = database.ref('numeros');
        
        let numeros = [];

        // Load initial data
        numerosRef.once('value').then((snapshot) => {
            if (snapshot.exists()) {
                numeros = snapshot.val();
            } else {
                // If no data exists, create initial list with 50 numbers
                numeros = Array.from({ length: 50 }, (_, i) => ({ 
                    numero: i + 1, 
                    nome: '', 
                    pago: false 
                }));
                salvarDados();
            }
            atualizarTabela();
        }).catch(error => {
            console.error("Error loading data:", error);
            alert("Erro ao carregar dados. Por favor, recarregue a página.");
        });

        // Listen for real-time changes
        numerosRef.on('value', (snapshot) => {
            if (snapshot.exists()) {
                numeros = snapshot.val();
                filtrarTabela(); // Update UI when changes occur
            }
        });

        function salvarDados() {
            try {
                numerosRef.set(numeros);
            } catch (erro) {
                alert('Erro ao salvar os dados. Por favor, tente novamente.');
                console.error('Save error:', erro);
            }
        }

        function atualizarTabela() {
            filtrarTabela();
            salvarDados();
        }

        function registrar() {
            const numero = parseInt(document.getElementById('numero').value);
            const nome = document.getElementById('nome').value.trim();

            if (!numero || numero < 1 || numero > numeros.length) {
                alert(`Escolha um número válido entre 1 e ${numeros.length}.`);
                return;
            }
            if (!nome) {
                alert('Por favor, insira seu nome.');
                return;
            }

            const index = numeros.findIndex(item => item.numero === numero);
            if (numeros[index].nome) {
                alert('Esse número já foi escolhido. Por favor, escolha outro.');
                return;
            }

            numeros[index].nome = nome;
            atualizarTabela();
            document.getElementById('numero').value = '';
            document.getElementById('nome').value = '';
        }

        function marcarPago(numero) {
            const index = numeros.findIndex(item => item.numero === numero);
            if (index >= 0) {
                numeros[index].pago = !numeros[index].pago;
                atualizarTabela();
            }
        }

        function editar(numero) {
            const index = numeros.findIndex(item => item.numero === numero);
            if (index >= 0) {
                const novoNome = prompt('Digite o novo nome:', numeros[index].nome);
                if (novoNome !== null) {
                    numeros[index].nome = novoNome.trim();
                    atualizarTabela();
                }
            }
        }

        function disponibilizar(numero) {
            const index = numeros.findIndex(item => item.numero === numero);
            if (index >= 0) {
                numeros[index].nome = '';
                numeros[index].pago = false;
                atualizarTabela();
            }
        }

        function gerarLista() {
            const lista = [
                "🎫 Lista de Números - Pega de Boi 🐂",
                "Número | Nome | Status",
                ...numeros.map(item => {
                    let status = '';
                    if (item.nome) {
                        status = item.pago ? '✅ Pago' : '⌛ Pendente';
                    } else {
                        status = '🟢 Disponível';
                    }
                    return `${item.numero} | ${item.nome || '---'} | ${status}`
                })
            ];
            const textoLista = lista.join('\n');
            document.getElementById('listaWhatsApp').value = textoLista;
        }

        function copiarLista() {
            const lista = document.getElementById('listaWhatsApp');
            
            if (!lista.value) {
                alert('Gere a lista primeiro antes de copiar.');
                return;
            }
            
            lista.select();
            lista.setSelectionRange(0, 99999); // For mobile devices
            
            try {
                navigator.clipboard.writeText(lista.value).then(() => {
                    showToast();
                }).catch(err => {
                    console.error('Copy error: ', err);
                    alert('Erro ao copiar. Tente novamente.');
                });
            } catch (err) {
                // Fallback for older browsers
                try {
                    document.execCommand('copy');
                    showToast();
                } catch (err) {
                    console.error('Copy error: ', err);
                    alert('Erro ao copiar. Tente novamente.');
                }
            }
        }

        function showToast() {
            const toast = document.getElementById('toast');
            toast.classList.add('show');
            
            setTimeout(() => {
                toast.classList.remove('show');
            }, 3000);
        }

        function limparLista() {
            if (confirm('Tem certeza que deseja limpar todos os números? Esta ação não pode ser desfeita.')) {
                numeros = [];
                atualizarTabela();
                document.getElementById('listaWhatsApp').value = '';
            }
        }

        function atualizarQuantidadeSenhas() {
            const novaQuantidade = parseInt(document.getElementById('quantidadeSenhas').value);
            
            if (!novaQuantidade || novaQuantidade < 1 || novaQuantidade > 1000) {
                alert('Por favor, insira uma quantidade válida entre 1 e 1000.');
                return;
            }

            // Create new list with desired quantity
            const novaLista = Array.from({ length: novaQuantidade }, (_, i) => ({
                numero: i + 1,
                nome: '',
                pago: false
            }));

            // Update list in Firebase
            numerosRef.set(novaLista)
                .then(() => {
                    numeros = novaLista;
                    atualizarTabela();
                    alert(`Lista atualizada com ${novaQuantidade} senhas.`);
                    document.getElementById('quantidadeSenhas').value = '';
                })
                .catch(error => {
                    console.error("Error updating quantity:", error);
                    alert("Erro ao atualizar quantidade. Por favor, tente novamente.");
                });
        }

        function filtrarTabela() {
            const buscarNome = document.getElementById('buscarNome').value.toLowerCase();
            const buscarNumero = document.getElementById('buscarNumero').value;
            const filtroStatus = document.getElementById('filtroStatus').value;

            let tabela = document.getElementById('tabela');
            tabela.innerHTML = '';

            let dadosFiltrados = numeros;

            if (filtroStatus !== 'todos') {
                dadosFiltrados = dadosFiltrados.filter(item => {
                    if (filtroStatus === 'disponivel') return !item.nome;
                    if (filtroStatus === 'pendente') return item.nome && !item.pago;
                    if (filtroStatus === 'pago') return item.pago;
                    return true;
                });
            }

            if (buscarNome || buscarNumero) {
                dadosFiltrados = dadosFiltrados.filter(item => {
                    const matchNome = item.nome && item.nome.toLowerCase().includes(buscarNome);
                    const matchNumero = item.numero.toString().includes(buscarNumero);
                    return matchNome || matchNumero;
                });
            }

            dadosFiltrados.forEach(item => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${item.numero}</td>
                    <td>${item.nome || 'Disponível'}</td>
                    <td>${item.pago ? '<span class="pago">Pago</span>' : item.nome ? 'Pendente' : 'Disponível'}</td>
                    <td>
                        <div class="action-buttons">
                            <button onclick="marcarPago(${item.numero})">
                                <i class="fas ${item.pago ? 'fa-times-circle' : 'fa-check-circle'}"></i> ${item.pago ? 'Pendente' : 'Pago'}
                            </button>
                            <button onclick="editar(${item.numero})">
                                <i class="fas fa-edit"></i> Editar
                            </button>
                            <button onclick="disponibilizar(${item.numero})">
                                <i class="fas fa-unlock"></i> Liberar
                            </button>
                        </div>
                    </td>
                `;
                tabela.appendChild(row);
            });
        }
    </script>
</body>
</html>
